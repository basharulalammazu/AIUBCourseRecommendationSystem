<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>AIUB Course Recomendation System</title>
    <meta name="theme-color" content="#0f172a" />
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="apple-touch-icon" href="icons/icon-192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/index.css" />
    <link rel="stylesheet" href="css/mediaqueries.css" />
  </head>
  <body>
    <button
      id="themeToggleBtn"
      class="theme-toggle"
      aria-label="Toggle dark mode"
      title="Toggle theme"
    >
      ğŸŒ™
    </button>

    <main class="container">
      <header class="hero fade-in">
        <h1 class="app-title">AIUB Course Recommendation System</h1>
        <p class="subtitle">
          Plan smarter. Pick the right courses. Generate optimized routines
          effortlessly.
        </p>
      </header>

      <section class="selection-card glass fade-in" style="--delay: 0.1s">
        <h2 class="section-title">Start Planning</h2>
        <p class="helper-text">
          Choose your department to explore offered courses and generate a
          routine.
        </p>
        <!-- Department Selector -->
        <div class="form-row">
          <label for="deptSelect">Department</label>
          <select id="deptSelect" aria-label="Select department">
            <option value="">-- Choose a department --</option>
            <option value="CSE">CSE</option>
            <option value="EEE">EEE</option>
            <option value="ENGLISH">ENGLISH</option>
            <option value="BBA">BBA</option>
            <option value="IPE">IPE</option>
          </select>
        </div>

        <!-- Action Buttons -->
        <div class="links-stack">
          <a
            href="routine.html"
            id="routineGeneratorBtn"
            class="btn secondary"
            data-independent="true"
            >ğŸ—“ï¸ Routine Generator (No Dept Needed)</a
          >
          <a
            href="javascript:void(0)"
            id="offerCoursesBtn"
            class="btn primary disabled"
            aria-disabled="true"
            >ï¿½ Offered Courses (Select Dept)</a
          >
        </div>
      </section>
    </main>
    <!-- Beautiful Developer & Download Section -->
    <section id="dev-section" class="fade-in" style="--delay: 0.2s">
      <div class="download-area">
        <h3>ğŸ¯ Get the Application</h3>
        <p class="download-description">
          Experience seamless course planning with our AIUB Course
          Recommendation System. Click below to download the latest Windows
          release directly from GitHub:
        </p>
        <a
          href="https://github.com/basharulalammazu/AIUB-Offered-Courses/releases/download/v3.3.0/AIUBOfferedCourse-V3.3.0.zip"
          target="_blank"
          class="btn accent"
        >
          â¬‡ï¸ Download for Windows
        </a>
        <div
          class="mobile-downloads"
          style="margin-top: 1rem; gap: 0.6rem; text-align: center"
        >
          <a
            href="#"
            class="btn secondary"
            id="androidDownloadBtn"
            title="Android APK coming soon"
            style="opacity: 0.7; cursor: not-allowed"
            >ğŸ¤– Android (Soon)</a
          >
          <a
            href="#"
            class="btn secondary"
            id="iosDownloadBtn"
            title="iOS build coming soon"
            style="opacity: 0.7; cursor: not-allowed"
            >ğŸ iOS (Soon)</a
          >
          <button
            class="btn outline"
            id="pwaInstallShortcut"
            style="display: none"
          >
            â¬‡ï¸ Install PWA
          </button>
        </div>
      </div>

      <div class="developer-area">
        <h3>ğŸ‘¨â€ğŸ’» Meet the Creators</h3>
        <p class="dev-intro">
          Developed with dedication by passionate engineers from AIUB.
        </p>
        <div class="dev-cards">
          <div class="dev-card">
            <img
              src="https://avatars.githubusercontent.com/basharulalammazu"
              alt="Basharul Alam Mazu"
            />
            <h4>Basharul - Alam - Mazu</h4>
            <a
              href="https://github.com/basharulalammazu"
              target="_blank"
              class="profile-link"
              >@basharulalammazu</a
            >
          </div>
          <div class="dev-card">
            <img
              src="https://avatars.githubusercontent.com/mdtanjimrahman"
              alt="Md Tanjim Rahman"
            />
            <h4>Md Tanjim Rahman</h4>
            <a
              href="https://github.com/mdtanjimrahman"
              target="_blank"
              class="profile-link"
              >@mdtanjimrahman</a
            >
          </div>
        </div>
      </div>
    </section>

    <footer class="app-footer fade-in" style="--delay: 0.3s">
      <p>
        Â© <span id="year"></span> AIUB Course Recommendation System â€¢ Crafted
        with focus on student success.
      </p>
    </footer>
    <button id="openSettingsBtn" class="fab-btn" aria-label="Settings">
      âš™ï¸
    </button>

    <!-- Settings / Update Modal -->
    <div
      id="settingsModal"
      class="modal hidden"
      aria-hidden="true"
      role="dialog"
      aria-modal="true"
    >
      <div class="modal-panel" role="document">
        <button
          class="close-btn"
          id="closeSettingsBtn"
          aria-label="Close settings"
        >
          âœ•
        </button>
        <h2 class="modal-title">App Settings</h2>
        <div class="modal-section">
          <h3>Version</h3>
          <p>Current Version: <span id="appVersion">1.0.0</span></p>
          <p id="updateStatus" class="muted">Status: up to date</p>
          <button id="checkUpdatesBtn" class="btn small">
            Check for Updates
          </button>
          <button id="applyUpdateBtn" class="btn small warning hidden">
            Apply Update & Reload
          </button>
        </div>
        <div class="modal-section">
          <h3>Cache</h3>
          <button id="clearCacheBtn" class="btn outline small">
            Clear Cached Assets
          </button>
        </div>
        <div class="modal-section">
          <h3>Install</h3>
          <button id="installAppBtn" class="btn small" style="display: none">
            Install App
          </button>
        </div>
        <div class="modal-section">
          <h3>Info</h3>
          <a
            id="changelogLink"
            href="changelog.html"
            class="link subtle"
            target="_blank"
            >View Changelog (v<span class="ver-inline">1.0.0</span>)</a
          >
          <button
            id="resetAllBtn"
            class="btn danger small"
            style="margin-top: 0.75rem"
          >
            Reset All Saved Data
          </button>
        </div>
      </div>
      <div class="modal-backdrop" tabindex="-1"></div>
    </div>
    <script src="js/theme.js"></script>
    <script src="js/script.js"></script>
    <script src="js/pwa.js"></script>
    <script>
      // Settings modal & SW update logic (index specific)
      (function () {
        const body = document.body;
        const modal = document.getElementById("settingsModal");
        const openBtn = document.getElementById("openSettingsBtn");
        const closeBtn = document.getElementById("closeSettingsBtn");
        const backdrop = modal.querySelector(".modal-backdrop");
        const checkBtn = document.getElementById("checkUpdatesBtn");
        const applyBtn = document.getElementById("applyUpdateBtn");
        const statusEl = document.getElementById("updateStatus");
        const installBtn = document.getElementById("installAppBtn");
        const clearCacheBtn = document.getElementById("clearCacheBtn");
        const resetBtn = document.getElementById("resetAllBtn");
        const changelogLink = document.getElementById("changelogLink");

        function openModal() {
          modal.classList.remove("hidden");
          modal.setAttribute("aria-hidden", "false");
          body.style.overflow = "hidden";
        }
        function closeModal() {
          modal.classList.add("hidden");
          modal.setAttribute("aria-hidden", "true");
          body.style.overflow = "";
        }
        openBtn.addEventListener("click", openModal);
        closeBtn.addEventListener("click", closeModal);
        backdrop.addEventListener("click", closeModal);
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && !modal.classList.contains("hidden"))
            closeModal();
        });

        // Offline detection for changelog link
        function updateOnlineState() {
          if (!navigator.onLine) {
            changelogLink.style.display = "none";
          } else {
            changelogLink.style.display = "inline";
          }
        }
        window.addEventListener("online", updateOnlineState);
        window.addEventListener("offline", updateOnlineState);
        updateOnlineState();

        // Update check logic
        let newWorker = null;
        if ("serviceWorker" in navigator) {
          navigator.serviceWorker.getRegistration().then((reg) => {
            if (!reg) return;
            reg.addEventListener("updatefound", () => {
              newWorker = reg.installing;
              newWorker.addEventListener("statechange", () => {
                if (
                  newWorker.state === "installed" &&
                  navigator.serviceWorker.controller
                ) {
                  statusEl.textContent = "Status: Update ready";
                  applyBtn.classList.remove("hidden");
                }
              });
            });
          });
        }
        checkBtn.addEventListener("click", () => {
          statusEl.textContent = "Status: Checking...";
          if ("serviceWorker" in navigator) {
            navigator.serviceWorker.getRegistration().then((reg) => {
              if (!reg) {
                statusEl.textContent = "Status: No SW registered";
                return;
              }
              reg.update().then(() => {
                setTimeout(() => {
                  if (!applyBtn.classList.contains("hidden")) {
                    statusEl.textContent = "Status: Update available";
                  } else {
                    statusEl.textContent = "Status: Up to date";
                  }
                }, 1200);
              });
            });
          }
        });
        applyBtn.addEventListener("click", () => {
          navigator.serviceWorker.getRegistration().then((reg) => {
            if (!reg) return;
            if (reg.waiting) {
              reg.waiting.postMessage("SKIP_WAITING");
              statusEl.textContent = "Status: Applying update...";
              setTimeout(() => window.location.reload(), 1000);
            }
          });
        });

        clearCacheBtn.addEventListener("click", async () => {
          if (!confirm("Clear cached assets?")) return;
          const keys = await caches.keys();
          for (const k of keys) await caches.delete(k);
          statusEl.textContent = "Status: Cache cleared. Reload recommended.";
        });

        resetBtn.addEventListener("click", () => {
          if (!confirm("Reset all saved data (localStorage) and reload?"))
            return;
          localStorage.clear();
          location.reload();
        });

        // PWA install shortcut in downloads section
        const pwaShortcut = document.getElementById("pwaInstallShortcut");
        if (window.matchMedia("(display-mode: standalone)").matches) {
          // Already installed: hide install shortcut & mark placeholders
          if (pwaShortcut) pwaShortcut.style.display = "none";
          const androidBtn = document.getElementById("androidDownloadBtn");
          const iosBtn = document.getElementById("iosDownloadBtn");
          if (androidBtn)
            androidBtn.textContent = "ğŸ¤– Android (Installed via PWA)";
          if (iosBtn) iosBtn.textContent = "ğŸ iOS (Installed via PWA)";
        }
        // Hook deferred prompt from pwa.js (if defined globally later)
        window.addEventListener("pwa-install-available", () => {
          if (pwaShortcut) {
            pwaShortcut.style.display = "inline-flex";
            pwaShortcut.addEventListener("click", () => triggerInstallPrompt());
          }
        });
      })();
    </script>
  </body>
</html>
