<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Routine Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Select2 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="css/routine.css" />

    <!-- JS Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script>
      // Set PDF.js worker source
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js";
    </script>
    <link rel="stylesheet" href="css/routine.css" />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <button
      id="themeToggleBtn"
      class="theme-toggle"
      aria-label="Toggle dark mode"
      title="Toggle theme"
    >
      üåô
    </button>
    <div class="container">
      <h2>üìÖ Routine Generator</h2>
      <a href="index.html" class="back-home"> ‚Üê Back to Home </a>

      <!-- New Scheduling Filters -->
      <div id="scheduleFilters" class="filters-block">
        <h3 style="margin-top: 10px">Schedule Preferences</h3>
        <div class="filters-grid">
          <div>
            <label style="margin-top: 0">Preferred Days:</label>
            <div class="day-checkboxes">
              <label
                ><input type="checkbox" class="day-filter" value="S" checked />
                S</label
              >
              <label
                ><input type="checkbox" class="day-filter" value="M" checked />
                M</label
              >
              <label
                ><input type="checkbox" class="day-filter" value="T" checked />
                T</label
              >
              <label
                ><input type="checkbox" class="day-filter" value="W" checked />
                W</label
              >
              <label
                ><input type="checkbox" class="day-filter" value="TH" checked />
                TH</label
              >
              <label
                ><input type="checkbox" class="day-filter" value="F" checked />
                F</label
              >
            </div>
            <small style="display: block; margin-top: 4px; color: #64748b"
              >Uncheck days you want to exclude from generated routines.</small
            >
          </div>
          <div>
            <label style="margin-top: 0" for="startTimeFilter"
              >Earliest Start (HH:MM 24h)</label
            >
            <input type="time" id="startTimeFilter" value="08:00" />
            <label for="endTimeFilter">Latest End (HH:MM 24h)</label>
            <input type="time" id="endTimeFilter" value="20:00" />
            <small style="display: block; margin-top: 4px; color: #64748b"
              >Classes must start at or after earliest and finish by
              latest.</small
            >
          </div>
          <!-- New Advanced Constraints Column -->
          <div>
            <label for="maxDaysInput" style="margin-top: 0"
              >Max Active Days (optional)</label
            >
            <input
              type="number"
              id="maxDaysInput"
              min="1"
              max="6"
              placeholder="e.g. 4"
            />

            <label for="maxGapInput">Max Gap (hours, optional)</label>
            <input
              type="number"
              id="maxGapInput"
              min="0"
              step="0.5"
              placeholder="e.g. 2"
            />
            <small style="display: block; margin-top: 4px; color: #64748b"
              >Reject routines with any gap larger than this value within a
              day.</small
            >

            <label for="lunchStartInput" style="margin-top: 14px"
              >Lunch Break Start (optional)</label
            >
            <input type="time" id="lunchStartInput" value="12:00" />
            <label for="lunchEndInput">Lunch Break End (optional)</label>
            <input type="time" id="lunchEndInput" value="13:00" />
            <small style="display: block; margin-top: 4px; color: #64748b"
              >If both set, exclude routines with classes overlapping
              lunch.</small
            >

            <label for="topCountInput" style="margin-top: 14px"
              >Show Top N Routines</label
            >
            <input
              type="number"
              id="topCountInput"
              min="1"
              max="50"
              value="3"
            />
            <small style="display: block; margin-top: 4px; color: #64748b"
              >Increase to see more ranked routine options.</small
            >
          </div>
        </div>
      </div>

      <label for="fileInput">Upload Routine File (Excel or PDF):</label>
      <input type="file" id="fileInput" accept=".xlsx,.pdf" />

      <label for="courseMultiSelect" class="hidden">Select Courses:</label>
      <select id="courseMultiSelect" multiple class="hidden"></select>

      <button id="generateBtn" onclick="generateRoutines()" class="hidden">
        Generate Routines
      </button>

      <div
        id="loadingSpinner"
        style="display: none; text-align: center; margin-top: 20px"
      >
        <div class="spinner"></div>
        <p>Loading, please wait...</p>
      </div>

      <div id="routineOutput"></div>
      <div id="loadingSpinner"></div>
    </div>

    <script src="js/theme.js"></script>
    <script src="js/routine.js"></script>
  </body>
</html>
